## Summary

- 根据 `/Users/geyunfei/.gemini/tmp` 的目录结构实现 Gemini 聊天记录解析，并将结果纳入统一的会话加载流程。
- 新增 `src/lib/providers/gemini.ts`，支持解析 `chats/*.json` 会话、提取 reasoning thoughts、token 统计及附件元数据。
- 更新服务器加载器与详情接口，返回 Gemini 结果并支持路径探测；前端默认源列表现已包含 Gemini。
- 扩充 API 集成测试与单元测试，覆盖 Gemini 转换和 `/api/sessions` 的端到端行为。
- 调整 `tasks.md` 标记 Gemini 适配任务完成。

涉及文件：`src/lib/providers/gemini.ts`, `src/lib/providers/gemini.test.ts`, `src/lib/session-loader/server.ts`, `src/types/chat.ts`, `src/app/api/__tests__/sessions-api.test.ts`, `src/app/api/sessions/route.ts`, `tasks.md`.

## Code Highlights

```ts
// src/lib/providers/gemini.ts
export function buildGeminiSession(
  filePath: string,
  document: GeminiSessionDocument,
): ChatSession | null {
  const messages: ChatMessage[] = [];
  rawMessages.forEach((raw, index) => {
    const role = ROLE_MAP[(raw.type ?? "").toLowerCase()] ?? "assistant";
    const metadata: MessageMetadata = {
      providerMessageType: raw.type,
      tokens: normaliseTokens(raw.tokens),
      attachments,
      raw,
    };
    if (Array.isArray(raw.thoughts) && raw.thoughts.length > 0) {
      const reasoning = buildReasoningDetail(raw.thoughts);
      metadata.reasoning = {
        summary: reasoning.summary,
        detail: reasoning.detail,
        providerType: "gemini-thought",
      };
      messages.push({
        id: `${baseId}:reasoning`,
        role: role === "user" ? "assistant" : role,
        kind: "reasoning",
        timestamp,
        content: reasoning.detail ?? reasoning.summary ?? null,
        metadata: {
          reasoning: { ...reasoning, providerType: "gemini-thought" },
          raw: raw.thoughts,
        },
      });
    }
    messages.push({
      id: baseId,
      role,
      kind: "content",
      timestamp,
      content,
      metadata,
    });
  });
  return {
    id: filePath,
    source: "gemini",
    topic,
    startedAt,
    participants: Array.from(participants),
    messages,
    metadata,
  };
}
```

```ts
// src/lib/session-loader/server.ts
const geminiCandidate =
  paths.gemini ?? (await resolveDefaultProviderRoot("gemini"));
const { path: geminiRoot, error: geminiPathError } =
  await normalizeProviderRoot(geminiCandidate);
if (geminiRoot) {
  const { loadGeminiSessions } = await import("@/lib/providers/gemini");
  const providerResult = await loadGeminiSessions(
    geminiRoot,
    filterProviderSignatures(previousSignatures, "gemini"),
    previousByFile,
  );
  sessions.push(...providerResult.sessions);
}
```

```ts
// src/app/api/__tests__/sessions-api.test.ts
const geminiSession = { ... };
await fs.writeFile(path.join(geminiDir, "session-gemini.json"), JSON.stringify(geminiSession, null, 2), "utf8");
const geminiSummary = result.sessions.find((summary) => summary.source === "gemini");
expect(geminiDetail.session?.messages.some((message) => message.kind === "reasoning")).toBe(true);
```

## Self-Tests

- `pnpm lint`（预期：无警告；实际：通过）
- `pnpm test`（预期：12 个测试文件全部通过；实际：通过）

## Risks & Follow-up

- 目前 Reasoning 信息以单条 `reasoning` 消息表示，后续可根据 UI 需求提供更细粒度展示。
- Gemini 文件结构若新增字段（如 tool 调用或附件类型）需要追加解析逻辑与测试覆盖。
